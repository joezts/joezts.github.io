<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="一、硬件服务器
名称：Sugon CB60-G10/15
CPU ：12个CPU × 2 GHz
内存：16G
存储器：280G
网卡数目：2
操作系统：VMware EXSi 5.0.0

二、OpenStack部署规划硬件需求
这是官网给出的硬件需求。这个需求是对于需要实际部署一些服务的场景而言的，尤其对于学生党来说，这个硬件需求很难达到，而且如果只是实验性的搭建一个小型OpenStack环境">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenStack Newton for Ubuntu 16.04 LTS安装部署教程">
<meta property="og:url" content="http://yoursite.com/2017/05/19/OpenStack-Newton版本手动搭建教程/index.html">
<meta property="og:site_name" content="Hello Joe">
<meta property="og:description" content="一、硬件服务器
名称：Sugon CB60-G10/15
CPU ：12个CPU × 2 GHz
内存：16G
存储器：280G
网卡数目：2
操作系统：VMware EXSi 5.0.0

二、OpenStack部署规划硬件需求
这是官网给出的硬件需求。这个需求是对于需要实际部署一些服务的场景而言的，尤其对于学生党来说，这个硬件需求很难达到，而且如果只是实验性的搭建一个小型OpenStack环境">
<meta property="og:image" content="http://oq39n17q4.bkt.clouddn.com/hardwarerequirement.jpg">
<meta property="og:image" content="http://oq39n17q4.bkt.clouddn.com/image/openstackinstallation/provider-network.jpg">
<meta property="og:image" content="http://oq39n17q4.bkt.clouddn.com/image/openstackinstallation/self-service.jpg">
<meta property="og:image" content="http://oq39n17q4.bkt.clouddn.com/image/openstackinstallation/network-layout.jpg">
<meta property="og:image" content="http://oq39n17q4.bkt.clouddn.com/image/openstackinstallation/MynNetLayout.png">
<meta property="og:updated_time" content="2017-10-25T09:34:12.395Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpenStack Newton for Ubuntu 16.04 LTS安装部署教程">
<meta name="twitter:description" content="一、硬件服务器
名称：Sugon CB60-G10/15
CPU ：12个CPU × 2 GHz
内存：16G
存储器：280G
网卡数目：2
操作系统：VMware EXSi 5.0.0

二、OpenStack部署规划硬件需求
这是官网给出的硬件需求。这个需求是对于需要实际部署一些服务的场景而言的，尤其对于学生党来说，这个硬件需求很难达到，而且如果只是实验性的搭建一个小型OpenStack环境">
<meta name="twitter:image" content="http://oq39n17q4.bkt.clouddn.com/hardwarerequirement.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/05/19/OpenStack-Newton版本手动搭建教程/"/>





  <title> OpenStack Newton for Ubuntu 16.04 LTS安装部署教程 | Hello Joe </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Hello Joe</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/19/OpenStack-Newton版本手动搭建教程/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Joe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/mee.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hello Joe">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hello Joe" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                OpenStack Newton for Ubuntu 16.04 LTS安装部署教程
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-19T21:40:22+08:00">
                2017-05-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="一、硬件服务器"><a href="#一、硬件服务器" class="headerlink" title="一、硬件服务器"></a>一、硬件服务器</h2><ul>
<li>名称：Sugon CB60-G10/15</li>
<li>CPU ：12个CPU × 2 GHz</li>
<li>内存：16G</li>
<li>存储器：280G</li>
<li>网卡数目：2</li>
<li>操作系统：VMware EXSi 5.0.0</li>
</ul>
<h2 id="二、OpenStack部署规划"><a href="#二、OpenStack部署规划" class="headerlink" title="二、OpenStack部署规划"></a>二、OpenStack部署规划</h2><h3 id="硬件需求"><a href="#硬件需求" class="headerlink" title="硬件需求"></a>硬件需求</h3><blockquote>
<p>这是官网给出的硬件需求。<br>这个需求是对于需要实际部署一些服务的场景而言的，尤其对于学生党来说，这个硬件需求很难达到，而且如果只是实验性的搭建一个小型OpenStack环境，硬件需求也不用达到这个标准。</p>
</blockquote>
<p><img src="http://oq39n17q4.bkt.clouddn.com/hardwarerequirement.jpg" alt="硬件需求"></p>
<p>图中实线框是不可缺少的核心，虚线框则是可选组件。本文<code>只部署了实线框所示的Controller节点和Compute节点</code>,对于对象存储节点（Object Storage Node）和块存储节点（Block Storage Node）可根据需要，按照本文搭建核心组件后，按照官网的步骤进行新节点部署。</p>
<a id="more"></a>
<h3 id="网络模型"><a href="#网络模型" class="headerlink" title="网络模型"></a>网络模型</h3><blockquote>
<p>官网提供了两种网络模型架构：Provider Network &amp; Self-Service Network</p>
</blockquote>
<ul>
<li><strong>Provider Network</strong></li>
</ul>
<ol>
<li>这是OpenStack最为简单的网络架构，主要是提供二层服务（layer-2，以网桥和交换机连接不同网络）和VLAN划分。其本质是将虚拟网络桥接到物理网络，并依靠物理网络基础设施来提供三层服务（layer-3，routing）。</li>
<li>DHCP服务将向实例提供IP地址信息。</li>
</ol>
<p><img src="http://oq39n17q4.bkt.clouddn.com/image/openstackinstallation/provider-network.jpg" alt="preovider-network"></p>
<ul>
<li><strong>Self-Service Network</strong></li>
</ul>
<ol>
<li>相当于Provider Network的增强版，在其基础上，增加了通过诸如VXLAN方式在自服务网络中提供三层路由服务。其本质是使用NAT的方式将虚拟网络路由到物理网络。</li>
<li>在这种网络模型下，还可以提供许多高级的服务，比如LBaaS（负载均衡即服务）和FWaaS（防火墙即服务）。</li>
</ol>
<p><img src="http://oq39n17q4.bkt.clouddn.com/image/openstackinstallation/self-service.jpg" alt="self-service-network"></p>
<p><strong>本文将采用Self-Service Network架构进行搭建</strong></p>
<h3 id="网络布局"><a href="#网络布局" class="headerlink" title="网络布局"></a>网络布局</h3><ul>
<li>官网的建议网络布局<blockquote>
<p>官方为了突出网络隔离，对于管理网络使用了私有地址空间。每个节点应当可以访问网络，用于安装软件，DNS，NTP等，Provider网络应当可以通过NAT的方式向管理网络提供访问外网的功能。</p>
</blockquote>
</li>
</ul>
<p><img src="http://oq39n17q4.bkt.clouddn.com/image/openstackinstallation/network-layout.jpg" alt="官方网络布局"></p>
<ul>
<li>本文使用的网络布局 </li>
</ul>
<p><img src="http://oq39n17q4.bkt.clouddn.com/image/openstackinstallation/MynNetLayout.png" alt="自己的网络布局"></p>
<h3 id="ML2网桥选择"><a href="#ML2网桥选择" class="headerlink" title="ML2网桥选择"></a>ML2网桥选择</h3><blockquote>
<p>OpenStack在L版（Liberty）及之前，各个节点中官方搭建文档都默认使用的OVS(OpenvSwitch)，从M版（Mitaka）开始，OpenStack默认使用的是Linux bridge来作为二层转发设备。</p>
</blockquote>
<p>笔者因为涉及到后续工作需要基于OVS来实现，所以这里并未按照官方默认的使用Linux bridge，节点中的br-int和br-tun<code>都是使用的OpenvSwitch</code>。所以在后面Networking部分，插件及代理都是安装的openvswitch，ML2配置文件中的mechanism_drivers也设置为openvswitch，还有一些地方也做了相应修改。</p>
<p><strong>如果你也刚好需要使用OVS作为二层转发设备，或者没有特别需求，可以直接按照本文进行安装配置。否则建议您直接按照官网的Installation Guide进行安装</strong></p>
<h3 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h3><table>
<thead>
<tr>
<th style="text-align:left">Node</th>
<th style="text-align:left">eth0</th>
<th style="text-align:left">eth1</th>
<th style="text-align:left">eth2</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Controller</td>
<td style="text-align:left">192.168.1.158</td>
<td style="text-align:left">80.0.0.11</td>
<td style="text-align:left">80.0.1.11</td>
</tr>
<tr>
<td style="text-align:left">Compute1</td>
<td style="text-align:left">192.168.1.180</td>
<td style="text-align:left">80.0.0.21</td>
<td style="text-align:left">80.0.1.21</td>
</tr>
<tr>
<td style="text-align:left">Compute2</td>
<td style="text-align:left">192.168.1.190</td>
<td style="text-align:left">80.0.0.22</td>
<td style="text-align:left">80.0.1.22</td>
</tr>
</tbody>
</table>
<p><strong>说明</strong></p>
<ol>
<li>eth0：外部网络，本地局域网是192.168.1.0/24，可以根据自己情况进行修改。用于各个节点主机连通外网，安装软件。</li>
<li>eth1：管理网络，网段可以自己定义。用于节点之间管理通信。</li>
<li>eth2：数据网络（隧道网络），网段可以自己定义。用于虚拟机实例内网数据传输。</li>
</ol>
<h3 id="各项服务密码设置"><a href="#各项服务密码设置" class="headerlink" title="各项服务密码设置"></a>各项服务密码设置</h3><blockquote>
<p>密码可以根据自己情况设置，不一定按照本文要求的来。但是如果是萌新，建议直接按照本文设置的密码进行配置，防止后面服务使用出问题。新手搭环境很容易出现各种问题，切身体会。</p>
</blockquote>
<ul>
<li>OpenStack管理员及租户账号密码</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">OpenStackUser name</th>
<th style="text-align:left">password</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">admin</td>
<td style="text-align:left">admin</td>
</tr>
<tr>
<td style="text-align:left">demo</td>
<td style="text-align:left">demo</td>
</tr>
</tbody>
</table>
<ul>
<li>各项服务的用户名及密码</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">Service name</th>
<th style="text-align:left">User name</th>
<th style="text-align:left">password</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Glance</td>
<td style="text-align:left">glance</td>
<td style="text-align:left">glance</td>
</tr>
<tr>
<td style="text-align:left">Nova</td>
<td style="text-align:left">nova</td>
<td style="text-align:left">nova</td>
</tr>
<tr>
<td style="text-align:left">Neutron</td>
<td style="text-align:left">neutron</td>
<td style="text-align:left">neutron</td>
</tr>
<tr>
<td style="text-align:left">RabbitMQ</td>
<td style="text-align:left">openstack</td>
<td style="text-align:left">openstack</td>
</tr>
</tbody>
</table>
<ul>
<li>数据库相关密码</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">DB name</th>
<th style="text-align:left">password</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">root</td>
<td style="text-align:left">openstack</td>
</tr>
<tr>
<td style="text-align:left">keystone</td>
<td style="text-align:left">keystone</td>
</tr>
<tr>
<td style="text-align:left">glance</td>
<td style="text-align:left">glance</td>
</tr>
<tr>
<td style="text-align:left">nova</td>
<td style="text-align:left">nova</td>
</tr>
<tr>
<td style="text-align:left">neutron</td>
<td style="text-align:left">neutron</td>
</tr>
</tbody>
</table>
<p><strong>总而言之，我一般将密码设置为与用户名相同，某些需自己设定账号密码的我都设置为<code>openstack</code></strong></p>
<h2 id="三、物理主机基本配置"><a href="#三、物理主机基本配置" class="headerlink" title="三、物理主机基本配置"></a>三、物理主机基本配置</h2><ol>
<li><p>物理机基本配置</p>
<ul>
<li>物理机安装EXSi 5.0系统</li>
</ul>
</li>
<li><p>物理机资源划分</p>
<blockquote>
<p>这里资源当然是多多益善啦，不过鉴于作者实际情况，只能先按此划分。<br>建议资源划分最小不小于以下情况</p>
</blockquote>
<ul>
<li>Controller节点：内存4G, CPU 4核,磁盘 50G， 网络适配器 3个</li>
<li>Compute1节点： 2G, CPU 2核，磁盘 40G，网络适配器 3个</li>
<li>ComputeN节点： 同上</li>
</ul>
</li>
</ol>
<h2 id="四、OpenStack基本配置"><a href="#四、OpenStack基本配置" class="headerlink" title="四、OpenStack基本配置"></a>四、OpenStack基本配置</h2><h3 id="网络环境准备"><a href="#网络环境准备" class="headerlink" title="网络环境准备"></a>网络环境准备</h3><p>如果使用VMware，将provider网络（本文是eth0）所在网络设置为混杂模式。</p>
<h3 id="配置网卡"><a href="#配置网卡" class="headerlink" title="配置网卡"></a>配置网卡</h3><blockquote>
<p>本文Host使用的是Ubuntu16.04 LTS，网卡名字为ens32这种类似的，出于习惯，我们将其改为eth0，eth1这种命名。</p>
</blockquote>
<p><strong>Controller Node &amp; Compute Node</strong></p>
<ol>
<li><p>修改文件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># vim /etc/default/grub`</div><div class="line"></div><div class="line">GRUB_CMDLINE_LINUX=”net.ifnames=0 biosdevname=0”</div></pre></td></tr></table></figure>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># grub-mkconfig -o /boot/grub/grub.cfg</div><div class="line"># reboot</div></pre></td></tr></table></figure>
<p> 重启后通过<code>ifconfig</code>命令可以看到网卡名称已经变为eth0，eth1，eth2。</p>
</li>
<li><p>配置网卡信息</p>
<blockquote>
<p>对于外部网络可是使用dhcp获取ip，这里设置静态ip是为了防止每次重启后ip变化管理起来不方便。<br>管理网络和隧道网络，根据自己为controller node和compute node设定的值进行配置即可。</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"># vim /etc/network/interfaces    </div><div class="line"></div><div class="line">auto lo</div><div class="line">iface lo inet loopback</div><div class="line">#外部网络provider</div><div class="line">auto eth0</div><div class="line">iface eth0 inet static</div><div class="line">address 192.168.1.158</div><div class="line">gateway 192.168.1.1</div><div class="line">netmask 255.255.255.0</div><div class="line">dns-nameservers 61.139.2.69</div><div class="line">#管理网络</div><div class="line">auto eth1</div><div class="line">iface eth1 inet static</div><div class="line">address 80.0.0.11</div><div class="line">netmask 255.255.255.0</div><div class="line">#隧道网络</div><div class="line">auto eth2</div><div class="line">iface eth2 inet static</div><div class="line">address 80.0.1.11</div><div class="line">netmask 255.255.255.0</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="修改hostname及hosts"><a href="#修改hostname及hosts" class="headerlink" title="修改hostname及hosts"></a>修改hostname及hosts</h3><blockquote>
<p>为了便于维护及管理，这里需要设置hosts及对应的ip。<br>这里暂时只给出一个Controller node和一个Compute node，后续有其他节点直接添加即可。</p>
</blockquote>
<ol>
<li><p>修改hosts</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># vim /etc/hosts</div><div class="line"></div><div class="line">127.0.0.1       localhost</div><div class="line">80.0.0.11       controller</div><div class="line">80.0.0.21       compute1</div></pre></td></tr></table></figure>
</li>
<li><p>修改hostname<br><strong>Controller Node</strong></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># vim /etc/hostname</div><div class="line"></div><div class="line">controller</div></pre></td></tr></table></figure>
<p> <strong>Compute Node</strong></p>
<blockquote>
<p>后续的计算节点依次为compute2，compute3……</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># vim /etc/hostname</div><div class="line"></div><div class="line">compute1</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="配置NTP"><a href="#配置NTP" class="headerlink" title="配置NTP"></a>配置NTP</h3><blockquote>
<p>NTP(Network Time Protocal),用于节点之间的时间同步，这里使用的是Chrony。</p>
</blockquote>
<p><strong>Controller Node</strong></p>
<ol>
<li><p>安装chrony</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># vim apt install chrony</div></pre></td></tr></table></figure>
</li>
<li><p>配置 </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># vim /etc/chrony/chrony.conf</div><div class="line"></div><div class="line">server 192.168.1.xxx iburst #增加一条以自己作为server</div><div class="line"></div><div class="line">allow 80.0.0.0/24 #允许该网段，即管理网络</div></pre></td></tr></table></figure>
</li>
<li><p>重启服务</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># service chrony restart</div></pre></td></tr></table></figure>
</li>
<li><p>验证配置是否成功</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># chrony sources</div><div class="line"></div><div class="line">210 Number of sources = 5</div><div class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample</div><div class="line">===============================================================================</div><div class="line">^? 192.168.1.158                 0  10     0   10y     +0ns[   +0ns] +/-    0ns</div><div class="line">^+ ntp4.itcompliance.dk          3  10   333   632    -57ms[  -56ms] +/-  246ms</div><div class="line">^+ mx.comglobalit.com            2  10   304   67m    +28ms[  +28ms] +/-  301ms</div><div class="line">^* biisoni.miuku.net             2  10   333    69    +29ms[  +30ms] +/-  128ms</div><div class="line">^+ 101.6.6.172                   2  10   377   238    +24ms[  +24ms] +/-  219ms</div></pre></td></tr></table></figure>
<p> 结果中有一项带*即可，表明当前节点与之同步。</p>
</li>
</ol>
<p><strong>Compute Node</strong></p>
<ol>
<li><p>安装chrony</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># vim apt install chrony</div></pre></td></tr></table></figure>
</li>
<li><p>配置 </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># vim /etc/chrony/chrony.conf</div><div class="line"></div><div class="line">server controller iburst #以controller作为server</div></pre></td></tr></table></figure>
</li>
<li><p>重启服务</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># service chrony restart</div></pre></td></tr></table></figure>
</li>
<li><p>验证配置是否成功</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># chrony sources</div><div class="line"></div><div class="line">210 Number of sources = 1</div><div class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample</div><div class="line">===============================================================================</div><div class="line">^* controller                    3   6   377    38   +294us[+6630us] +/-  116ms</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="配置OpenStack版本"><a href="#配置OpenStack版本" class="headerlink" title="配置OpenStack版本"></a>配置OpenStack版本</h3><p><strong>Controller Node &amp; Compute Node</strong></p>
<ol>
<li><p>添加 Newton版本库</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># apt install software-properties-common</div><div class="line"># add-apt-repository cloud-archive:newton</div></pre></td></tr></table></figure>
</li>
<li><p>更新包</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># apt update &amp;&amp; apt dist-upgrade</div><div class="line"># reboot</div></pre></td></tr></table></figure>
</li>
<li><p>安装openstack 客户端</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt install python-openstackclient</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="SQL数据库"><a href="#SQL数据库" class="headerlink" title="SQL数据库"></a>SQL数据库</h3><blockquote>
<p>一般来说，数据库服务只运行在Controller Node上，这里OpenStack官方建议是使用MariaDB。</p>
</blockquote>
<p><strong>Controller Node</strong></p>
<ol>
<li><p>安装数据库，中途会提示为数据库设置密码，本人是将其设置为openstack，各位可以按自己喜好来，只要别忘了就行-0-</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt install mariadb-server python-pymysql</div></pre></td></tr></table></figure>
</li>
<li><p>新建并配置文件<code>/etc/mysql/mariadb.conf.d/99-openstack.cnf</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># vim /etc/mysql/mariadb.conf.d/99-openstack.cnf</div><div class="line"></div><div class="line">[mysqld]</div><div class="line">bind-address = 80.0.0.11</div><div class="line">default-storage-engine = innodb</div><div class="line">innodb_file_per_table</div><div class="line">max_connections = 4096</div><div class="line">collation-server = utf8_general_ci</div><div class="line">character-set-server = utf8</div></pre></td></tr></table></figure>
</li>
<li><p>完成安装，重启服务</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># service mysql restart</div><div class="line"># mysql_secure_installation</div></pre></td></tr></table></figure>
<ul>
<li>mysql_secure_installation是为了进行一些保障SQL安全性的操作，比如删除匿名用户，为root账户设置密码等。</li>
</ul>
</li>
</ol>
<h3 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h3><blockquote>
<p>OpenStack使用消息队列来进行各项服务之间的协作以及状态信息交互的。一般来说，消息队列服务运行在Controller节点上。<br>OpenStack支持RabbitMQ，Qpid，ZeroMQ等消息队列服务。这里使用的是RabbitMQ。</p>
</blockquote>
<ol>
<li><p>安装软件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt install rabbitmq-server</div></pre></td></tr></table></figure>
</li>
<li><p>添加名为openstack的用户</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># rabbitmqctl add_user openstack openstack</div></pre></td></tr></table></figure>
<blockquote>
<p>这里用户名和密码都设置为openstack</p>
</blockquote>
</li>
<li><p>为openstack用户赋予配置、读、写权限</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="Memcached"><a href="#Memcached" class="headerlink" title="Memcached"></a>Memcached</h3><blockquote>
<p>Identity服务认证机制采用Memcached来缓存token。<br>Memcached服务运行在Controller节点上</p>
</blockquote>
<ul>
<li><strong>Controller Node</strong></li>
</ul>
<ol>
<li><p>安装软件包</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt install memcached python-memcache</div></pre></td></tr></table></figure>
</li>
<li><p>编辑配置文件<code>/etc/memcached.conf</code>，</p>
<blockquote>
<p>将原有的 -l 127.0.0.1替换为如下内容</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># vim /etc/memcached.conf</div><div class="line"></div><div class="line">-l 80.0.0.11  #即Controller节点的管理网络ip</div></pre></td></tr></table></figure>
</li>
<li><p>重启服务</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># service memcached restart</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="五、身份认证服务-Identity-Service-–-Keystone"><a href="#五、身份认证服务-Identity-Service-–-Keystone" class="headerlink" title="五、身份认证服务 Identity Service – Keystone"></a>五、身份认证服务 Identity Service – Keystone</h2><blockquote>
<p>OpenStack认证服务提供身份认证，授权，服务目录的功能。</p>
</blockquote>
<h3 id="为Keystone创建数据库"><a href="#为Keystone创建数据库" class="headerlink" title="为Keystone创建数据库"></a>为Keystone创建数据库</h3><ol>
<li><p>以root身份登录进数据库</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># mysql -uroot -popenstack</div></pre></td></tr></table></figure>
</li>
<li><p>创建<code>keystone</code>数据库</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt; CREATE DATABASE keystone;</div></pre></td></tr></table></figure>
</li>
<li><p>授予<code>keystone</code>数据库正确的访问权限</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; GRANT ALL PRIVILEGES ON keystone.* TO &apos;keystone&apos;@&apos;localhost&apos; \</div><div class="line">  IDENTIFIED BY &apos;keystone&apos;;</div><div class="line">&gt; GRANT ALL PRIVILEGES ON keystone.* TO &apos;keystone&apos;@&apos;%&apos; \</div><div class="line">  IDENTIFIED BY &apos;keystone&apos;;</div><div class="line">&gt; exit</div></pre></td></tr></table></figure>
<blockquote>
<p>将keystone数据库密码也设置为keystone</p>
</blockquote>
</li>
</ol>
<h3 id="安装并配置组件"><a href="#安装并配置组件" class="headerlink" title="安装并配置组件"></a>安装并配置组件</h3><ol>
<li><p>安装<code>keystone</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt install keystone</div></pre></td></tr></table></figure>
</li>
<li><p>编辑配置文件<code>/etc/keystone/keystone.conf</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># vim /etc/keystone/keystone.conf</div><div class="line">[database]</div><div class="line">……</div><div class="line">connection = mysql+pymysql://keystone:keystone@controller/keystone</div><div class="line">[token]</div><div class="line">……</div><div class="line">provider = fernet</div></pre></td></tr></table></figure>
<blockquote>
<p>配置文件中的……表明其余项不作修改，仅仅添加新项</p>
</blockquote>
</li>
<li><p>将配置信息写入数据库，初始化数据库中的表</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># su -s /bin/sh -c &quot;keystone-manage db_sync&quot; keystone</div></pre></td></tr></table></figure>
</li>
<li><p>初始化Fernet keys</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</div><div class="line"># keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</div></pre></td></tr></table></figure>
</li>
<li><p>Identity service引导程序，创建endpoint等</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># keystone-manage bootstrap --bootstrap-password admin \</div><div class="line">  --bootstrap-admin-url http://controller:35357/v3/ \</div><div class="line">  --bootstrap-internal-url http://controller:35357/v3/ \</div><div class="line">  --bootstrap-public-url http://controller:5000/v3/ \</div><div class="line">  --bootstrap-region-id RegionOne</div></pre></td></tr></table></figure>
<blockquote>
<p>–bootstrap-password指定的是admin用户的密码，这里也设置为admin</p>
</blockquote>
</li>
</ol>
<h3 id="配置Apache-HTTP-server"><a href="#配置Apache-HTTP-server" class="headerlink" title="配置Apache HTTP server"></a>配置Apache HTTP server</h3><ol>
<li><p>编辑配置文件<code>/etc/apache2/apache2.conf</code>，配置ServerName指向controller</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># vim /etc/apache2/apache2.conf</div><div class="line"></div><div class="line">ServerName controller</div></pre></td></tr></table></figure>
</li>
<li><p>删除默认的SQLite数据库</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># rm -f /var/lib/keystone/keystone.db</div></pre></td></tr></table></figure>
</li>
<li><p>配置admin账户，写一个脚本<code>admin-openrc</code>来导入环境变量</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># vim admin-openrc</div><div class="line">export OS_USERNAME=admin</div><div class="line">export OS_PASSWORD=admin</div><div class="line">export OS_PROJECT_NAME=admin</div><div class="line">export OS_USER_DOMAIN_NAME=default</div><div class="line">export OS_PROJECT_DOMAIN_NAME=default</div><div class="line">export OS_AUTH_URL=http://controller:35357/v3</div><div class="line">export OS_IDENTITY_API_VERSION=3</div></pre></td></tr></table></figure>
<blockquote>
<p>PASSWORD取值要与keystone-manage bootstrap中的password一致。</p>
</blockquote>
<p> 接着执行以下命令导入环境变量</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># . admin-openrc</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="创建-domain，project，user，role"><a href="#创建-domain，project，user，role" class="headerlink" title="创建 domain，project，user，role"></a>创建 domain，project，user，role</h3><blockquote>
<p>认证服务结合了domain，project，user和role四个域</p>
</blockquote>
<ol>
<li><p>创建service project，其中的user为OpenStack的各项服务</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack project create --domain default --description &quot;Service Project&quot; service</div></pre></td></tr></table></figure>
</li>
<li><p>为非admin用户创建project和user</p>
<blockquote>
<p>这里命名为demo</p>
</blockquote>
</li>
</ol>
<ul>
<li><p>创建<code>demo</code> project和user</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># openstack project create --domain default --description &quot;Demo Project&quot; demo</div><div class="line"># openstack user create --domain default --password-prompt demo</div></pre></td></tr></table></figure>
<blockquote>
<p>demo user 的密码也设为demo</p>
</blockquote>
</li>
<li><p>创建<code>user</code> role</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack role create user</div></pre></td></tr></table></figure>
</li>
<li><p>将<code>user</code> role添加到<code>demo</code>project的<code>demo</code>user上。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack role add --project demo --user demo user</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="验证操作"><a href="#验证操作" class="headerlink" title="验证操作"></a>验证操作</h3><ol>
<li>出于安全考虑，取消掉临时token的验证机制<br> 编辑<code>/etc/keystone/keystone-paste.ini</code>文件，将[pipeline:public_api], [pipeline:admin_api], and [pipeline:api_v3]区域中的admin_token_auth移除。</li>
<li><p>撤销环境变量</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># unset OS_AUTH_URL OS_PASSWORD</div></pre></td></tr></table></figure>
</li>
<li><p>以admin用户身份去请求一个验证token</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># openstack --os-auth-url http://controller:35357/v3 \</div><div class="line">  --os-project-domain-name default --os-user-domain-name default \</div><div class="line">  --os-project-name admin --os-username admin token issue</div></pre></td></tr></table></figure>
<blockquote>
<p>输入admin用户的密码<code>admin</code></p>
</blockquote>
</li>
</ol>
<h3 id="环境变量脚本"><a href="#环境变量脚本" class="headerlink" title="环境变量脚本"></a>环境变量脚本</h3><blockquote>
<p>为<code>admin</code>和<code>demo</code> project和user创建换了变量脚本。</p>
</blockquote>
<ol>
<li><p>在之前的<code>admin-openrc</code>中添加一项</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">......</div><div class="line">export OS_IMAGE_API_VERSION=2</div></pre></td></tr></table></figure>
</li>
<li><p>新建<code>demo-openrc</code>脚本</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># vim demo-openrc</div><div class="line">export OS_PROJECT_DOMAIN_NAME=default</div><div class="line">export OS_USER_DOMAIN_NAME=default</div><div class="line">export OS_PROJECT_NAME=demo</div><div class="line">export OS_USERNAME=demo</div><div class="line">export OS_PASSWORD=demo</div><div class="line">export OS_AUTH_URL=http://controller:5000/v3</div><div class="line">export OS_IDENTITY_API_VERSION=3</div><div class="line">export OS_IMAGE_API_VERSION=2</div></pre></td></tr></table></figure>
</li>
<li><p>使用脚本添加换金变量，并请求一个token</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># . admin-openrc</div><div class="line"># openstack token issue</div></pre></td></tr></table></figure>
<ul>
<li>有结果输出即表明keystone配置完成。</li>
</ul>
</li>
</ol>
<h2 id="六、镜像管理服务-Image-Service-–-Glance"><a href="#六、镜像管理服务-Image-Service-–-Glance" class="headerlink" title="六、镜像管理服务 Image Service – Glance"></a>六、镜像管理服务 Image Service – Glance</h2><blockquote>
<p>镜像服务为用户提供虚拟机镜像的注册，检索服务<br>该服务只运行于Controller节点上</p>
</blockquote>
<h3 id="为Glance创建数据库"><a href="#为Glance创建数据库" class="headerlink" title="为Glance创建数据库"></a>为Glance创建数据库</h3><ol>
<li><p>以root身份登录进数据库</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># mysql -uroot -popenstack</div></pre></td></tr></table></figure>
</li>
<li><p>创建glance数据库，并赋予正确的访问权限</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; CREATE DATABASE glance;</div><div class="line">&gt; GRANT ALL PRIVILEGES ON glance.* TO &apos;glance&apos;@&apos;localhost&apos; \</div><div class="line">  IDENTIFIED BY &apos;glance&apos;;</div><div class="line">&gt; GRANT ALL PRIVILEGES ON glance.* TO &apos;glance&apos;@&apos;%&apos; \</div><div class="line">  IDENTIFIED BY &apos;glance&apos;;</div><div class="line">&gt;exit</div></pre></td></tr></table></figure>
<blockquote>
<p>glance数据库的密码设为glance</p>
</blockquote>
</li>
</ol>
<h3 id="为glance服务创建用户，服务实体，访问点"><a href="#为glance服务创建用户，服务实体，访问点" class="headerlink" title="为glance服务创建用户，服务实体，访问点"></a>为glance服务创建用户，服务实体，访问点</h3><ol>
<li><p>以<code>admin</code>身份去使用管理员权限的CLI</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ . admin-openrc</div></pre></td></tr></table></figure>
</li>
<li><p>为glance服务在service project里创建一个用户</p>
</li>
</ol>
<ul>
<li><p>创建<code>glance</code>用户</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># openstack user create --domain default --password-prompt glance</div><div class="line"></div><div class="line">User Password:</div><div class="line">Repeat User Password:</div></pre></td></tr></table></figure>
<blockquote>
<p>将密码设置为glance</p>
</blockquote>
</li>
<li><p>将<code>service</code>project中的<code>glance</code>用户赋予<code>admin</code>角色</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack role add --project service --user glance admin</div></pre></td></tr></table></figure>
</li>
<li><p>创建glance服务实体</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack service create --name glance --description &quot;OpenStack Image&quot; image</div></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li>创建镜像服务的API访问点 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># openstack endpoint create --region RegionOne image public http://controller:9292</div><div class="line"># openstack endpoint create --region RegionOne image internal http://controller:9292</div><div class="line"># openstack endpoint create --region RegionOne image admin http://controller:9292</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="安装和配置镜像服务"><a href="#安装和配置镜像服务" class="headerlink" title="安装和配置镜像服务"></a>安装和配置镜像服务</h3><ol>
<li><p>安装<code>glance</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt install glance</div></pre></td></tr></table></figure>
</li>
<li><p>编辑配置文件<code>/etc/glance/glance-api.conf</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"># vim /etc/glance/glance-api.conf </div><div class="line"></div><div class="line">[database]</div><div class="line">……</div><div class="line">connection = mysql+pymysql://glance:glance@controller/glance</div><div class="line"> #注释或者删除掉keystone_authtoken中的其他所有选项</div><div class="line">[keystone_authtoken]</div><div class="line">auth_uri = http://controller:5000</div><div class="line">auth_url = http://controller:35357</div><div class="line">memcached_servers = controller:11211</div><div class="line">auth_type = password</div><div class="line">project_domain_name = default</div><div class="line">user_domain_name = default</div><div class="line">project_name = service</div><div class="line">username = glance</div><div class="line">password = glance</div><div class="line"> </div><div class="line">[paste_deploy]</div><div class="line">...</div><div class="line">flavor = keystone</div><div class="line"> </div><div class="line">[glance_store]</div><div class="line">...</div><div class="line">stores = file,http</div><div class="line">default_store = file</div><div class="line">filesystem_store_datadir = /var/lib/glance/images/</div></pre></td></tr></table></figure>
<blockquote>
<p>…表示只新增项，原有配置不变</p>
</blockquote>
</li>
<li><p>编辑配置文件<code>/etc/glance/glance-registry.conf</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">#vim /etc/glance/glance-registry.conf</div><div class="line"></div><div class="line">[database]</div><div class="line">...</div><div class="line">connection = mysql+pymysql://glance:glance@controller/glance</div><div class="line"> </div><div class="line">#注释或者删除掉keystone_authtoken中的其他所有选项</div><div class="line">[keystone_authtoken]</div><div class="line">...</div><div class="line">auth_uri = http://controller:5000</div><div class="line">auth_url = http://controller:35357</div><div class="line">memcached_servers = controller:11211</div><div class="line">auth_type = password</div><div class="line">project_domain_name = default</div><div class="line">user_domain_name = default</div><div class="line">project_name = service</div><div class="line">username = glance</div><div class="line">password = glance</div><div class="line"> </div><div class="line">[paste_deploy]</div><div class="line">...</div><div class="line">flavor = keystone</div></pre></td></tr></table></figure>
</li>
<li><p>将配置信息写入数据库，初始化数据库中的表</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># su -s /bin/sh -c &quot;glance-manage db_sync&quot; glance</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="重启服务，完成安装"><a href="#重启服务，完成安装" class="headerlink" title="重启服务，完成安装"></a>重启服务，完成安装</h3><ol>
<li><p>重启服务</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># service glance-registry restart</div><div class="line"># service glance-api restart</div></pre></td></tr></table></figure>
</li>
<li><p>下载镜像并上传至Glance</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># wget http://download.cirros-cloud.net/0.3.4/cirros-0.3.4-x86_64-disk.img</div><div class="line"># openstack image create &quot;cirros&quot; \</div><div class="line">--file cirros-0.3.4-x86_64-disk.img \</div><div class="line">--disk-format qcow2 --container-format bare \</div><div class="line">--public</div></pre></td></tr></table></figure>
</li>
<li><p>查看镜像</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># openstack image list</div><div class="line"></div><div class="line">+--------------------------------------+--------+--------+</div><div class="line">| ID                                   | Name   | Status |</div><div class="line">+--------------------------------------+--------+--------+</div><div class="line">| 547e9e90-9863-49dd-bacc-f00d84d6f920 | cirros | active |</div><div class="line">+--------------------------------------+--------+--------+</div></pre></td></tr></table></figure>
<blockquote>
<p>结果中会显示刚刚上传的cirros镜像，Status为active</p>
</blockquote>
</li>
</ol>
<h2 id="七、计算服务-Compute-Service-–-Nova"><a href="#七、计算服务-Compute-Service-–-Nova" class="headerlink" title="七、计算服务 Compute Service – Nova"></a>七、计算服务 Compute Service – Nova</h2><blockquote>
<p>该服务在Controller节点和Compute节点都需要安装</p>
</blockquote>
<p><strong>Controller Node</strong></p>
<h3 id="为Nova创建数据库"><a href="#为Nova创建数据库" class="headerlink" title="为Nova创建数据库"></a>为Nova创建数据库</h3><ol>
<li><p>以root身份登录进数据库</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># mysql -uroot -popenstack</div></pre></td></tr></table></figure>
</li>
<li><p>创建<code>nova</code>数据库，并赋予正确的访问权限</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; CREATE DATABASE nova_api;</div><div class="line">&gt; CREATE DATABASE nova;</div><div class="line">&gt; GRANT ALL PRIVILEGES ON nova_api.* TO &apos;nova&apos;@&apos;localhost&apos; \</div><div class="line">  IDENTIFIED BY &apos;nova&apos;;</div><div class="line">&gt; GRANT ALL PRIVILEGES ON nova_api.* TO &apos;nova&apos;@&apos;%&apos; \</div><div class="line">  IDENTIFIED BY &apos;nova&apos;;</div><div class="line">&gt; GRANT ALL PRIVILEGES ON nova.* TO &apos;nova&apos;@&apos;localhost&apos; \</div><div class="line">  IDENTIFIED BY &apos;nova&apos;;</div><div class="line">&gt; GRANT ALL PRIVILEGES ON nova.* TO &apos;nova&apos;@&apos;%&apos; \</div><div class="line">  IDENTIFIED BY &apos;nova&apos;;</div><div class="line">&gt;exit</div></pre></td></tr></table></figure>
<blockquote>
<p>数据库密码设为<code>nova</code></p>
</blockquote>
</li>
</ol>
<h3 id="为nova服务创建用户，服务实体，访问点"><a href="#为nova服务创建用户，服务实体，访问点" class="headerlink" title="为nova服务创建用户，服务实体，访问点"></a>为nova服务创建用户，服务实体，访问点</h3><ol>
<li><p>以<code>admin</code>身份去使用管理员权限的CLI</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ . admin-openrc</div></pre></td></tr></table></figure>
</li>
<li><p>为nova服务在service project里创建一个用户</p>
</li>
</ol>
<ul>
<li><p>创建<code>nova</code>用户</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># openstack user create --domain default --password-prompt nova</div><div class="line">User Password:</div><div class="line">Repeat User Password:</div></pre></td></tr></table></figure>
<blockquote>
<p>将密码设置为nova</p>
</blockquote>
</li>
<li><p>将<code>service</code>project中的<code>nova</code>用户赋予<code>admin</code>角色</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack role add --project service --user nova admin</div></pre></td></tr></table></figure>
</li>
<li><p>创建nova服务实体</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack service create --name nova --description &quot;OpenStack Compute&quot; compute</div></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li>创建计算服务的API访问点 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># openstack endpoint create --region RegionOne  compute public http://controller:8774/v2.1/%\(tenant_id\)s</div><div class="line"># openstack endpoint create --region RegionOne compute internal http://controller:8774/v2.1/%\(tenant_id\)s</div><div class="line"># openstack endpoint create --region RegionOne compute admin http://controller:8774/v2.1/%\(tenant_id\)s</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="安装和配置计算服务"><a href="#安装和配置计算服务" class="headerlink" title="安装和配置计算服务"></a>安装和配置计算服务</h3><ol>
<li><p>安装nova相关组件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt install nova-api nova-conductor nova-consoleauth nova-novncproxy nova-scheduler</div></pre></td></tr></table></figure>
</li>
<li><p>编辑配置文件<code>/etc/nova/nova.conf</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"># vim /etc/nova/nova.conf</div><div class="line"></div><div class="line">[DEFAULT]</div><div class="line">...</div><div class="line">transport_url = rabbit://openstack:openstack@controller</div><div class="line">auth_strategy = keystone</div><div class="line">my_ip = 80.0.0.11</div><div class="line">use_neutron = True</div><div class="line">firewall_driver = nova.virt.firewall.NoopFirewallDriver</div><div class="line"> </div><div class="line">[api_database]</div><div class="line">connection = mysql+pymysql://nova:nova@controller/nova_api</div><div class="line">     </div><div class="line">[database]</div><div class="line">connection = mysql+pymysql://nova:nova@controller/nova</div><div class="line"> </div><div class="line">[keystone_authtoken]</div><div class="line">auth_uri = http://controller:5000</div><div class="line">auth_url = http://controller:35357</div><div class="line">memcached_servers = controller:11211</div><div class="line">auth_type = password</div><div class="line">project_domain_name = default</div><div class="line">user_domain_name = default</div><div class="line">project_name = service</div><div class="line">username = nova</div><div class="line">password = nova</div><div class="line"> </div><div class="line">[vnc]</div><div class="line">vncserver_listen = 80.0.0.11</div><div class="line">vncserver_proxyclient_address = 80.0.0.11</div><div class="line"> </div><div class="line">[glance]</div><div class="line">api_servers = http://controller:9292</div><div class="line"> </div><div class="line">[oslo_concurrency]</div><div class="line">lock_path = /var/lib/nova/tmp</div></pre></td></tr></table></figure>
<p> <strong>由于bug，需要删除掉<code>[DEFAULT]</code>中的<code>log-dir</code></strong></p>
</li>
</ol>
<h3 id="重启服务，完成安装-1"><a href="#重启服务，完成安装-1" class="headerlink" title="重启服务，完成安装"></a>重启服务，完成安装</h3><ol>
<li>重启计算服务 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># service nova-api restart</div><div class="line"># service nova-consoleauth restart</div><div class="line"># service nova-scheduler restart</div><div class="line"># service nova-conductor restart</div><div class="line"># service nova-novncproxy restart</div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>Compute Node</strong></p>
<h3 id="安装和配置计算服务-1"><a href="#安装和配置计算服务-1" class="headerlink" title="安装和配置计算服务"></a>安装和配置计算服务</h3><ol>
<li><p>安装nova相关组件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt install nova-compute</div></pre></td></tr></table></figure>
</li>
<li><p>编辑配置文件<code>/etc/nova/nova.conf</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"># vim /etc/nova/nova.conf</div><div class="line"></div><div class="line">#消息队列配置</div><div class="line">[DEFAULT]</div><div class="line">...</div><div class="line">transport_url = rabbit://openstack:openstack@controller</div><div class="line">auth_strategy = keystone</div><div class="line">my_ip = 80.0.0.21</div><div class="line">use_neutron = True</div><div class="line">firewall_driver = nova.virt.firewall.NoopFirewallDriver</div><div class="line"> </div><div class="line">#注释掉keystone_authtoken中其他选项</div><div class="line">[keystone_authtoken]</div><div class="line">auth_uri = http://controller:5000</div><div class="line">auth_url = http://controller:35357</div><div class="line">memcached_servers = controller:11211</div><div class="line">auth_type = password</div><div class="line">project_domain_name = default</div><div class="line">user_domain_name = default</div><div class="line">project_name = service</div><div class="line">username = nova</div><div class="line">password = nova</div><div class="line"> </div><div class="line">#配置vnc远程登录</div><div class="line">[vnc]</div><div class="line">enabled = True</div><div class="line">vncserver_listen = 0.0.0.0</div><div class="line">vncserver_proxyclient_address = 80.0.0.21</div><div class="line">novncproxy_base_url = http://controller:6080/vnc_auto.html</div><div class="line"> </div><div class="line">#配置镜像服务API</div><div class="line">[glance]</div><div class="line">api_servers = http://controller:9292</div><div class="line"> </div><div class="line">[oslo_concurrency]</div><div class="line">lock_path = /var/lib/nova/tmp</div></pre></td></tr></table></figure>
<p> <strong>由于bug，需要移除掉<code>[DEFAULT]</code>中的<code>log-dir</code></strong></p>
</li>
</ol>
<h3 id="完成安装"><a href="#完成安装" class="headerlink" title="完成安装"></a>完成安装</h3><ol>
<li><p>检测计算节点是否支持虚拟机硬件加速</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># egrep -c &apos;(vmx|svm)&apos; /proc/cpuinfo</div></pre></td></tr></table></figure>
<blockquote>
<p>如果结果是大于等于1的值，则无需修改；若值为0，则进行以下步骤，将virt_type设置为qemu</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># vim /etc/nova/nova-compute.conf</div><div class="line"></div><div class="line">[libvirt]</div><div class="line">...</div><div class="line">virt_type = qemu</div></pre></td></tr></table></figure>
</li>
<li><p>重启服务</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># service nova-compute restart</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="验证操作-1"><a href="#验证操作-1" class="headerlink" title="验证操作"></a>验证操作</h3><p><strong>Controller Node</strong></p>
<blockquote>
<p>在控制节点进行下面的验证操作</p>
</blockquote>
<ol>
<li><p>以<code>admin</code>身份去使用管理员权限的CLI</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ . admin-openrc</div></pre></td></tr></table></figure>
</li>
<li><p>列出计算服务<br> 如果前面配置成功，这里会有3个服务运行在Controller节点，一个服务运行在Compute节点</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">+----+------------------+------------+----------+---------+-------+----------------------------+</div><div class="line">| ID | Binary           | Host       | Zone     | Status  | State | Updated At                 |</div><div class="line">+----+------------------+------------+----------+---------+-------+----------------------------+</div><div class="line">|  3 | nova-consoleauth | controller | internal | enabled | up    | 2017-06-04T10:04:02.000000 |</div><div class="line">|  4 | nova-scheduler   | controller | internal | enabled | up    | 2017-06-04T10:03:58.000000 |</div><div class="line">|  5 | nova-conductor   | controller | internal | enabled | up    | 2017-06-04T10:04:05.000000 |</div><div class="line">|  6 | nova-compute     | compute1   | nova     | enabled | up    | 2017-06-04T10:04:07.000000 |</div><div class="line">+----+------------------+------------+----------+---------+-------+----------------------------+</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="八、网络服务-Networking-Service-–-Neutron"><a href="#八、网络服务-Networking-Service-–-Neutron" class="headerlink" title="八、网络服务 Networking Service – Neutron"></a>八、网络服务 Networking Service – Neutron</h2><blockquote>
<p>该服务在Controller节点和Compute节点都需要安装</p>
</blockquote>
<p><strong>Controller Node</strong></p>
<h3 id="为Neutron创建数据库"><a href="#为Neutron创建数据库" class="headerlink" title="为Neutron创建数据库"></a>为Neutron创建数据库</h3><ol>
<li><p>以root身份登录进数据库</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># mysql -uroot -popenstack</div></pre></td></tr></table></figure>
</li>
<li><p>创建<code>neutron</code>数据库，并赋予正确的访问权限</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; CREATE DATABASE neutron;</div><div class="line">&gt; GRANT ALL PRIVILEGES ON neutron.* TO &apos;neutron&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;neutron&apos;;</div><div class="line">&gt; GRANT ALL PRIVILEGES ON neutron.* TO &apos;neutron&apos;@&apos;%&apos; IDENTIFIED BY &apos;neutron&apos;;</div><div class="line">&gt; exit</div></pre></td></tr></table></figure>
<blockquote>
<p>数据库密码设为<code>neutron</code></p>
</blockquote>
</li>
</ol>
<h3 id="为neutron服务创建用户，服务实体，访问点"><a href="#为neutron服务创建用户，服务实体，访问点" class="headerlink" title="为neutron服务创建用户，服务实体，访问点"></a>为neutron服务创建用户，服务实体，访问点</h3><ol>
<li><p>以<code>admin</code>身份去使用管理员权限的CLI</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ . admin-openrc</div></pre></td></tr></table></figure>
</li>
<li><p>为neutron服务在service project里创建一个用户</p>
</li>
</ol>
<ul>
<li><p>创建<code>neutron</code>用户</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># openstack user create --domain default --password-prompt neutron</div><div class="line">User Password:</div><div class="line">Repeat User Password:</div></pre></td></tr></table></figure>
<blockquote>
<p>将密码设置为neutron</p>
</blockquote>
</li>
<li><p>将<code>service</code>project中的<code>neutron</code>用户赋予<code>admin</code>角色</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack role add --project service --user neutron admin</div></pre></td></tr></table></figure>
</li>
<li><p>创建neutron服务实体</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack service create --name neutron --description &quot;OpenStack Networking&quot; network</div></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li>创建网络服务的API访问点 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># openstack endpoint create --region RegionOne network public http://controller:9696</div><div class="line"># openstack endpoint create --region RegionOne network internal http://controller:9696</div><div class="line"># openstack endpoint create --region RegionOne network admin http://controller:9696</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="网络架构部署"><a href="#网络架构部署" class="headerlink" title="网络架构部署"></a>网络架构部署</h3><blockquote>
<p>这里使用官网介绍的第二种架构–Self-Service Networks</p>
</blockquote>
<ol>
<li><p>安装neutron相关组件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># apt install neutron-server neutron-plugin-ml2 \</div><div class="line">neutron-openvswitch-agent neutron-l3-agent neutron-dhcp-agent \</div><div class="line">neutron-metadata-agent</div></pre></td></tr></table></figure>
</li>
<li><p>配置外部网桥br-ex，并设置默认路由</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># ovs-vsctl add-br br-ex</div><div class="line"># ovs-vsctl add-port br-ex eth0</div><div class="line"># ifconfig eth0 0</div><div class="line"># ifconfig br-ex 192.168.1.158</div><div class="line"># route add default gw 192.168.1.1</div></pre></td></tr></table></figure>
</li>
<li><p>编辑neutron server配置文件<code>/etc/neutron/neutron.conf</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">[database]</div><div class="line">...</div><div class="line">connection = mysql+pymysql://neutron:neutron@controller/neutron</div><div class="line"> </div><div class="line">[DEFAULT]</div><div class="line">...</div><div class="line">core_plugin = ml2</div><div class="line">service_plugins = router</div><div class="line">allow_overlapping_ips = True</div><div class="line">transport_url = rabbit://openstack:openstack@controller</div><div class="line">auth_strategy = keystone</div><div class="line"> </div><div class="line">[keystone_authtoken]</div><div class="line">...</div><div class="line">auth_uri = http://controller:5000</div><div class="line">auth_url = http://controller:35357</div><div class="line">memcached_servers = controller:11211</div><div class="line">auth_type = password</div><div class="line">project_domain_name = default</div><div class="line">user_domain_name = default</div><div class="line">project_name = service</div><div class="line">username = neutron</div><div class="line">password = neutron</div><div class="line"> </div><div class="line">[nova]</div><div class="line">...</div><div class="line">auth_url = http://controller:35357</div><div class="line">auth_type = password</div><div class="line">project_domain_name = default</div><div class="line">user_domain_name = default</div><div class="line">region_name = RegionOne</div><div class="line">project_name = service</div><div class="line">username = nova</div><div class="line">password = nova</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="配置插件及代理"><a href="#配置插件及代理" class="headerlink" title="配置插件及代理"></a>配置插件及代理</h3><ol>
<li><p>配置ML2 plug-in</p>
<blockquote>
<p> Modular Layer 2 (ML2) 使用OpenvSwitch机制来构建二层虚拟网络。<br>官网目前默认使用的是Linux bridge机制,有需要的可按照官网安装文档进行安装配置。</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"># vim /etc/neutron/plugins/ml2/ml2_conf.ini</div><div class="line"></div><div class="line">[ml2]</div><div class="line">...</div><div class="line">type_drivers = flat,vlan,vxlan</div><div class="line">tenant_network_types = vxlan</div><div class="line">mechanism_drivers = openvswitch,l2population</div><div class="line">extension_drivers = port_security</div><div class="line"> </div><div class="line">[ml2_type_flat]</div><div class="line">...</div><div class="line">flat_networks = external</div><div class="line"> </div><div class="line">[ml2_type_vxlan]</div><div class="line">...</div><div class="line">vni_ranges = 1:1000</div><div class="line"> </div><div class="line">[securitygroup]</div><div class="line">...</div><div class="line">enable_security_group = True</div><div class="line">enable_ipset = True</div><div class="line">firewall_driver = iptables_hybrid</div></pre></td></tr></table></figure>
</li>
<li><p>配置L3 agent</p>
<blockquote>
<p>Layer-3 (L3) agent为self-service虚拟网络提供路由及NAT服务。</p>
</blockquote>
<p> 编辑<code>/etc/neutron/l3_agent.ini</code>文件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[DEFAULT]</div><div class="line">...</div><div class="line">interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver</div><div class="line">external_network_bridge =</div></pre></td></tr></table></figure>
<ul>
<li>external_network_bridge值故意空缺，这样可使多个外部网络共用一个代理。</li>
</ul>
</li>
<li><p>配置DHCP agent</p>
<blockquote>
<p>DHCP agent为虚拟网络提供DHCP服务。</p>
</blockquote>
<p> 编辑<code>/etc/neutron/dhcp_agent.ini</code>文件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[DEFAULT]</div><div class="line">...</div><div class="line">interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver</div><div class="line">dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq</div><div class="line">enable_isolated_metadata = True</div></pre></td></tr></table></figure>
</li>
<li><p>配置OpenvSwitch agent</p>
<blockquote>
<p>OpenvSwitch agent为实例建立了二层虚拟网络设施</p>
</blockquote>
<p> 编辑<code>/etc/neutron/plugins/ml2/openvswitch_agent.ini</code>文件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"># vim /etc/neutron/plugins/ml2/openvswitch_agent.ini</div><div class="line">[ovs]</div><div class="line">integration_bridge = br-int</div><div class="line">bridge_mappings = external:br-ex</div><div class="line">local_ip = 80.0.1.11</div><div class="line"> </div><div class="line">[agent]</div><div class="line">tunnel_types = vxlan</div><div class="line">l2_population = True</div><div class="line"> </div><div class="line">[securitygroup]</div><div class="line">#enable_security_group = True</div><div class="line">firewall_driver = iptables_hybrid</div></pre></td></tr></table></figure>
</li>
<li><p>配置metadata agent</p>
<blockquote>
<p>meatadata agent向实例提供配置信息</p>
</blockquote>
<p> 编辑<code>/etc/neutron/metadata_agent.ini</code>文件，shared secret设置为openstack。</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[DEFAULT]</div><div class="line">...</div><div class="line">nova_metadata_ip = controller</div><div class="line">metadata_proxy_shared_secret = openstack</div></pre></td></tr></table></figure>
</li>
<li><p>配置计算服务使用网络服务<br> 编辑<code>/etc/nova/nova.conf</code>文件</p>
<blockquote>
<p>metadata_proxy_shared_secret值要与上一步中的相同，这里也为openstack</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[neutron]</div><div class="line">url = http://controller:9696</div><div class="line">auth_url = http://controller:35357</div><div class="line">auth_type = password</div><div class="line">project_domain_name = default</div><div class="line">user_domain_name = default</div><div class="line">region_name = RegionOne</div><div class="line">project_name = service</div><div class="line">username = neutron</div><div class="line">password = neutron</div><div class="line">service_metadata_proxy = True</div><div class="line">metadata_proxy_shared_secret = openstack</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="完成安装-1"><a href="#完成安装-1" class="headerlink" title="完成安装"></a>完成安装</h3><ol>
<li><p>将配置信息写入数据库，初始化数据库中的表</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># su -s /bin/sh -c &quot;neutron-db-manage --config-file /etc/neutron/neutron.conf \</div><div class="line">--config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot; neutron</div></pre></td></tr></table></figure>
</li>
<li><p>重启Compute  API服务</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># service nova-api restart</div></pre></td></tr></table></figure>
</li>
<li><p>重启Networking服务</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># service neutron-server restart</div><div class="line"># service neutron-openvswitch-agent restart</div><div class="line"># service neutron-dhcp-agent restart</div><div class="line"># service neutron-metadata-agent restart</div><div class="line"># service neutron-l3-agent restart</div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>Compute Node</strong></p>
<h3 id="安装网neutron相关组件"><a href="#安装网neutron相关组件" class="headerlink" title="安装网neutron相关组件"></a>安装网neutron相关组件</h3><ol>
<li><p>安装软件包</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt install neutron-plugin-ml2 neutron-openvswitch-agent</div></pre></td></tr></table></figure>
</li>
<li><p>编辑<code>/etc/neutron/neutron.conf</code>文件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"># vim /etc/neutron/neutron.conf</div><div class="line"></div><div class="line">[database]</div><div class="line">#注释掉所有connection选项，因为compute节点不需要直接操作数据库</div><div class="line"> </div><div class="line">[DEFAULT]</div><div class="line">...</div><div class="line">transport_url = rabbit://openstack:openstack@controller</div><div class="line">auth_strategy = keystone</div><div class="line">core_plugin = ml2</div><div class="line">service_plugins = router</div><div class="line">allow_overlapping_ips = True</div><div class="line">verbose = True</div><div class="line"> </div><div class="line">[keystone_authtoken]</div><div class="line">...</div><div class="line">auth_uri = http://controller:5000</div><div class="line">auth_url = http://controller:35357</div><div class="line">memcached_servers = controller:11211</div><div class="line">auth_type = password</div><div class="line">project_domain_name = default</div><div class="line">user_domain_name = default</div><div class="line">project_name = service</div><div class="line">username = neutron</div><div class="line">password = neutron</div></pre></td></tr></table></figure>
</li>
<li><p>配置ML2 plug-in<br> 编辑<code>/etc/neutron/plugins/ml2/ml2_conf.ini</code>文件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[ml2]</div><div class="line">type_drivers = flat,vlan,vxlan</div><div class="line">tenant_network_types = vxlan</div><div class="line">mechanism_drivers = openvswitch</div><div class="line">extension_drivers = port_security</div><div class="line"> </div><div class="line">[securitygroup]</div><div class="line">enable_ipset = True</div><div class="line"> </div><div class="line">[ml2_type_vxlan]</div><div class="line">vni_ranges = 1:1000</div></pre></td></tr></table></figure>
</li>
<li><p>配置OpenvSwitch agent<br> 编辑<code>/etc/neutron/plugins/ml2/openvswitch_agent.ini</code>文件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"># vim /etc/neutron/plugins/ml2/openvswitch_agent.ini</div><div class="line"></div><div class="line">[ovs]</div><div class="line">integration_bridge = br-int</div><div class="line">local_ip = 80.0.1.21</div><div class="line"> </div><div class="line">[agent]</div><div class="line">tunnel_types = vxlan</div><div class="line">l2_population = True</div><div class="line"> </div><div class="line">[securitygroup]</div><div class="line">enable_security_group = True</div><div class="line">firewall_driver = iptables_hybrid</div></pre></td></tr></table></figure>
</li>
<li><p>配置计算服务使用网络服务<br> 编辑<code>/etc/nova/nova.conf</code>文件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"># vim /etc/nova/nova.conf</div><div class="line"></div><div class="line">[neutron]</div><div class="line">url = http://controller:9696</div><div class="line">auth_url = http://controller:35357</div><div class="line">auth_type = password</div><div class="line">project_domain_name = default</div><div class="line">user_domain_name = default</div><div class="line">region_name = RegionOne</div><div class="line">project_name = service</div><div class="line">username = neutron</div><div class="line">password = neutron</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="完成安装-2"><a href="#完成安装-2" class="headerlink" title="完成安装"></a>完成安装</h3><ol>
<li><p>重启计算服务</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># service nova-compute restart</div></pre></td></tr></table></figure>
</li>
<li><p>重启代理服务</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#  service neutron-openvswitch-agent restart</div></pre></td></tr></table></figure>
</li>
</ol>
<p>###验证操作<br><strong>Controller Node</strong></p>
<blockquote>
<p>在Controoler节点执行验证操作</p>
</blockquote>
<ol>
<li><p>以<code>admin</code>身份去使用管理员权限的CLI</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ . admin-openrc</div></pre></td></tr></table></figure>
</li>
<li><p>列出已加载的extensions</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># neutron ext-list</div></pre></td></tr></table></figure>
</li>
<li><p>列出成功运行的neutron agent</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># neutron agent-list</div></pre></td></tr></table></figure>
<p> 就当前部署情况，应该有4个agent在Controller节点，一个agent在计算节点</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">    +--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+</div><div class="line">| id                                   | agent_type         | host       | availability_zone | alive | admin_state_up | binary                    |</div><div class="line">+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+</div><div class="line">| 075e6e72-4a85-4845-a427-cd3ef45b9803 | Metadata agent     | controller |                   | :-)   | True           | neutron-metadata-agent    |</div><div class="line">| 1805ba7f-7f7d-4e8d-8415-8f63f3f40cc5 | DHCP agent         | controller | nova              | :-)   | True           | neutron-dhcp-agent        |</div><div class="line">| 4b3b5877-37e2-4de3-a5ec-f89786000bb9 | L3 agent           | controller | nova              | :-)   | True           | neutron-l3-agent          |</div><div class="line">| 7e3ec045-336f-43ff-a130-8cfe24951aa6 | Open vSwitch agent | compute1   |                   | :-)   | True           | neutron-openvswitch-agent |</div><div class="line">| bcccd6de-99a0-4a63-9042-8f655efd8ea0 | Open vSwitch agent | controller |                   | :-)   | True           | neutron-openvswitch-agent |</div><div class="line">+--------------------------------------+--------------------+------------+-------------------+-------+----------------+---------------------------+</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="九、前端仪表盘-Dashboard-–-Horizon"><a href="#九、前端仪表盘-Dashboard-–-Horizon" class="headerlink" title="九、前端仪表盘 Dashboard – Horizon"></a>九、前端仪表盘 Dashboard – Horizon</h2><blockquote>
<p>这是一个可选组件，用于提供一个可视化界面，让云管理者和用户可以通过Web接口来操作和管理OpenStack资源与服务。<br>该组件安装和配置在Controller节点。</p>
</blockquote>
<h3 id="安装和配置仪表盘"><a href="#安装和配置仪表盘" class="headerlink" title="安装和配置仪表盘"></a>安装和配置仪表盘</h3><ol>
<li><p>安装<code>dashboard</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt install openstack-dashboard</div></pre></td></tr></table></figure>
</li>
<li><p>编辑配置文件<code>/etc/openstack-dashboard/local_settings.py</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"># vim /etc/openstack-dashboard/local_settings.py</div><div class="line"></div><div class="line">OPENSTACK_HOST = &quot;controller&quot;</div><div class="line">ALLOWED_HOSTS = [&apos;*&apos;, ]</div><div class="line"></div><div class="line">SESSION_ENGINE = &apos;django.contrib.sessions.backends.cache&apos;</div><div class="line"></div><div class="line">CACHES = &#123;</div><div class="line">    &apos;default&apos;: &#123;</div><div class="line">         &apos;BACKEND&apos;: &apos;django.core.cache.backends.memcached.MemcachedCache&apos;,</div><div class="line">         &apos;LOCATION&apos;: &apos;controller:11211&apos;,</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">OPENSTACK_KEYSTONE_URL = &quot;http://%s:5000/v3&quot; % OPENSTACK_HOST</div><div class="line">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True</div><div class="line">OPENSTACK_API_VERSIONS = &#123;</div><div class="line">    &quot;identity&quot;: 3,</div><div class="line">    &quot;image&quot;: 2,</div><div class="line">    &quot;volume&quot;: 2,</div><div class="line">&#125;</div><div class="line">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = &quot;default&quot;</div><div class="line">OPENSTACK_KEYSTONE_DEFAULT_ROLE = &quot;user&quot;</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="验证操作-2"><a href="#验证操作-2" class="headerlink" title="验证操作"></a>验证操作</h3><ol>
<li><p>重新载入web server配置</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># service apache2 reload</div></pre></td></tr></table></figure>
</li>
<li><p>使用浏览器打开dashboard<br>打开浏览器，在网址栏中输入<code>http://controller/horizon</code>,出现登陆界面后，以admin用户或者demo用户的身份登陆进去即可。</p>
</li>
<li><p>Bug解决<br>如果在上面一步中，输入网址后并未出现登陆界面，并出现ERROR，则需要进行下面两步解决。</p>
</li>
</ol>
<ul>
<li><p>在配置文件<code>/etc/apache2/conf-enabled/openstack-dashboard.conf</code>中添加一行</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># vim /etc/apache2/conf-enabled/openstack-dashboard.conf</div><div class="line"></div><div class="line">#在WSGIProcessGroup horizon下一行添加</div><div class="line">WSGIApplicationGroup %&#123;GLOBAL&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>进入到<code>/usr/share/openstack-dashboard</code>目录,运行manage.py</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># cd /usr/share/openstack-dashboard</div><div class="line"># python manage.py compress</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="十、创建虚拟机实例"><a href="#十、创建虚拟机实例" class="headerlink" title="十、创建虚拟机实例"></a>十、创建虚拟机实例</h2><blockquote>
<p>上述步骤已经安装部署好了所有的基本组件，OpenStack已经可以开始使用了，下面将介绍一些基本的使用方法，包括创建虚拟网络，路由器，实例，添加floating ip等。</p>
</blockquote>
<h3 id="创建provider虚拟网络"><a href="#创建provider虚拟网络" class="headerlink" title="创建provider虚拟网络"></a>创建provider虚拟网络</h3><ol>
<li><p>以<code>admin</code>身份去使用管理员权限的CLI</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ . admin-openrc</div></pre></td></tr></table></figure>
</li>
<li><p>创建provider网络</p>
<blockquote>
<p>这里命名为ext-net</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># neutron net-create ext-net --router:external --provider:physical_network external --provider:network_type flat</div></pre></td></tr></table></figure>
<p> <strong>参数说明</strong></p>
<ul>
<li><code>--router:external</code>：使self-service的router可以使用该网络来连接到外部网络，比如Internet</li>
<li><code>--provider:physical_network</code>：指定flat虚拟网络连接到哪个flat物理网络上</li>
<li><code>--provider:network_type</code>：指定provider网络类型，这里将其设置为flat</li>
</ul>
<p>–provider:physical_network参数是使用的<code>ml2_conf.ini</code>中指定的参数</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[ml2_type_flat]</div><div class="line">flat_networks = external</div></pre></td></tr></table></figure>
</li>
<li><p>创建provider子网</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># neutron subnet-create ext-net 192.168.1.0/24 --name ext-subnet \</div><div class="line">  --allocation-pool start=192.168.1.180,end=192.168.1.199 \</div><div class="line">  --disable-dhcp --gateway 192.168.1.1</div></pre></td></tr></table></figure>
<p> <strong>参数说明</strong></p>
<ul>
<li><code>--name</code>：子网名称</li>
<li><code>--allocation-pool</code>：start和end指定了你想为虚拟机实例分配的ip地址范围，请确保该范围内的地址可用</li>
<li><code>--disable-dhcp</code>：撤销这个子网的DHCP功能</li>
<li><code>--gateway</code>：指定这个子网的网关</li>
</ul>
</li>
</ol>
<h3 id="创建self-service虚拟网络及路由器"><a href="#创建self-service虚拟网络及路由器" class="headerlink" title="创建self-service虚拟网络及路由器"></a>创建self-service虚拟网络及路由器</h3><ol>
<li><p>以<code>demo</code>身份去获取user身份的CLI使用权</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ . demo-openrc</div></pre></td></tr></table></figure>
</li>
<li><p>创建self-service网络</p>
<blockquote>
<p>这里命名为demo-net</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># neutron net-create demo-net</div></pre></td></tr></table></figure>
</li>
<li><p>创建self-service子网</p>
<blockquote>
<p>我将虚拟内部子网网段定义为90.0.0.0/24，这个可以根据自己情况修改</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># neutron subnet-create demo-net 90.0.0.0/24 --name demo-subnet --dns-nameserver 61.139.2.69 --gateway 90.0.0.1</div></pre></td></tr></table></figure>
</li>
<li><p>创建demo租户的路由器</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># neutron router-create demo-router</div></pre></td></tr></table></figure>
</li>
<li><p>在demo-router上加一个接口，将self-service子网（demo-subnet）添加上去</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># neutron router-interface-add demo-router demo-subnet</div></pre></td></tr></table></figure>
</li>
<li><p>在demo-router上设置一个provider网络的网关</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># neutron router-gateway-set demo-router ext-net</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="验证虚拟网络"><a href="#验证虚拟网络" class="headerlink" title="验证虚拟网络"></a>验证虚拟网络</h3><ol>
<li><p>以<code>admin</code>身份去使用管理员权限的CLI</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ . admin-openrc</div></pre></td></tr></table></figure>
</li>
<li><p>列出名字空间（namespace）</p>
<blockquote>
<p>可以看到一个qrouter和一个qdhcp</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># ip netns</div><div class="line">qrouter-8afe6ad1-3a63-4036-a374-275b0c44fef2</div><div class="line">qdhcp-20dcee41-145b-4210-83c9-3bcd7b4f732a</div></pre></td></tr></table></figure>
</li>
<li><p>列出demo-router上的接口</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># neutron router-port-list demo-router</div><div class="line"></div><div class="line">+--------------------------------------+------+-------------------+--------------------------------------------------------------------------------------+</div><div class="line">| id                                   | name | mac_address       | fixed_ips                                                                            |</div><div class="line">+--------------------------------------+------+-------------------+--------------------------------------------------------------------------------------+</div><div class="line">| b4fbf9c0-4f49-43e3-8808-6f241c8b7631 |      | fa:16:3e:a7:2b:0d | &#123;&quot;subnet_id&quot;: &quot;cfbf6897-6e94-4b08-8783-2c982ffd0b6e&quot;, &quot;ip_address&quot;: &quot;90.0.0.1&quot;&#125;      |</div><div class="line">| ed881f13-c09d-4dc7-9225-d95f6df47865 |      | fa:16:3e:6a:38:c0 | &#123;&quot;subnet_id&quot;: &quot;572af278-9ac6-4c6f-8771-966e7a22d3ea&quot;, &quot;ip_address&quot;: &quot;192.168.1.181&quot;&#125; |</div><div class="line">+--------------------------------------+------+-------------------+--------------------------------------------------------------------------------------+</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="准备创建实例的参数"><a href="#准备创建实例的参数" class="headerlink" title="准备创建实例的参数"></a>准备创建实例的参数</h3><ol>
<li><p>以<code>admin</code>身份去执行命令</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ . admin-openrc</div></pre></td></tr></table></figure>
</li>
<li><p>新建合适的flavor</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack flavor create --id 1 --vcpus 1 --ram 512 --disk 1 m1.tiny</div></pre></td></tr></table></figure>
<p> 列出可用的flavor</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack flavor list</div></pre></td></tr></table></figure>
</li>
<li><p>以<code>demo</code>身份执行后续操作</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ . demo-openrc</div></pre></td></tr></table></figure>
</li>
<li><p>创建key pair</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># ssh-keygen -q -N &quot;&quot;</div><div class="line"># openstack keypair create --public-key ~/.ssh/id_rsa.pub mykey</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="增加安全组规则"><a href="#增加安全组规则" class="headerlink" title="增加安全组规则"></a>增加安全组规则</h3><blockquote>
<p>默认情况下，<code>default</code>安全组将应用于所有的实例，并且阻止所有的远程接入。对于Linux镜像，比如之前上传的Cirros镜像，建议至少需要允许ICMP（ping）和SSH。</p>
</blockquote>
<ol>
<li><p>允许ICMP</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack security group rule create --proto icmp default</div></pre></td></tr></table></figure>
</li>
<li><p>允许SSH</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack security group rule create --proto tcp --dst-port 22 default</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="在self-service网络上创建虚拟机实例"><a href="#在self-service网络上创建虚拟机实例" class="headerlink" title="在self-service网络上创建虚拟机实例"></a>在self-service网络上创建虚拟机实例</h3><ol>
<li><p>以<code>demo</code>身份执行后续操作</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ . demo-openrc</div></pre></td></tr></table></figure>
</li>
<li><p>列出各项参数的可选值</p>
</li>
</ol>
<ul>
<li><p>列出flavor</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># nova flavor-list</div><div class="line"></div><div class="line">+----+------------+-----------+------+-----------+------+-------+-------------+-----------+</div><div class="line">| ID | Name       | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |</div><div class="line">+----+------------+-----------+------+-----------+------+-------+-------------+-----------+</div><div class="line">| 1  | m1.tiny    | 512       | 1    | 0         |      | 1     | 1.0         | True      |</div><div class="line">+----+------------+-----------+------+-----------+------+-------+-------------+-----------+</div></pre></td></tr></table></figure>
</li>
<li><p>列出image</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># openstack image  list</div><div class="line">+--------------------------------------+--------+--------+</div><div class="line">| ID                                   | Name   | Status |</div><div class="line">+--------------------------------------+--------+--------+</div><div class="line">| 547e9e90-9863-49dd-bacc-f00d84d6f920 | cirros | active |</div><div class="line">+--------------------------------------+--------+--------+</div></pre></td></tr></table></figure>
</li>
<li><p>列出net</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># neutron net-list</div><div class="line">+--------------------------------------+----------+--------------------------------------------------+</div><div class="line">| id                                   | name     | subnets                                          |</div><div class="line">+--------------------------------------+----------+--------------------------------------------------+</div><div class="line">| 20dcee41-145b-4210-83c9-3bcd7b4f732a | demo-net | cfbf6897-6e94-4b08-8783-2c982ffd0b6e 90.0.0.0/24 |</div><div class="line">| 71e40f62-98cb-438b-94ee-0b7e06d9ee17 | ext-net  | 572af278-9ac6-4c6f-8771-966e7a22d3ea             |</div><div class="line">+--------------------------------------+----------+--------------------------------------------------+</div></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li><p>创建实例 </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack server create --flavor m1.tiny --image cirros --nic net-id=20dcee41-145b-4210-83c9-3bcd7b4f732a --security-group default --key-name mykey demo-ins</div></pre></td></tr></table></figure>
</li>
<li><p>查看实例</p>
<blockquote>
<p>下面两个命令都可以查看</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># openstack server list</div><div class="line"># nova list</div></pre></td></tr></table></figure>
</li>
<li><p>通过VNC登陆到实例</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># openstack console url show demo-ins</div><div class="line"></div><div class="line">+-------+---------------------------------------------------------------------------------+</div><div class="line">| Field | Value                                                                           |</div><div class="line">+-------+---------------------------------------------------------------------------------+</div><div class="line">| type  | novnc                                                                           |</div><div class="line">| url   | http://controller:6080/vnc_auto.html?token=5eeccb47-525c-4918-ac2a-3ad1e9f1f493 |</div><div class="line">+-------+---------------------------------------------------------------------------------+</div></pre></td></tr></table></figure>
<p> 将结果中的url复制到浏览器中即可查看实例。</p>
</li>
<li><p>在namespace中SSH进实例</p>
<blockquote>
<p>此时实例只有内部网络的ip，在Controller节点上是无法SSH到实例的。但是我们可以通过Controller节点中的qrouter namespace进入到实例。</p>
</blockquote>
</li>
</ol>
<ul>
<li><p>查看namespace</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># ip netns</div><div class="line">qrouter-8afe6ad1-3a63-4036-a374-275b0c44fef2</div><div class="line">qdhcp-20dcee41-145b-4210-83c9-3bcd7b4f732a</div></pre></td></tr></table></figure>
</li>
<li><p>在qrouter中SSH到实例</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># ip netns exec qrouter-8afe6ad1-3a63-4036-a374-275b0c44fef2 ssh cirros@90.0.0.3</div></pre></td></tr></table></figure>
<p>  其中的ip地址根据自己实例的具体值修改。</p>
</li>
</ul>
<ol>
<li>创建并绑定floating ip<blockquote>
<p>此时实例只有内部ip，如果想从外部访问实例，则需要为实例添加一个floating ip</p>
</blockquote>
</li>
</ol>
<ul>
<li><p>创建floating ip</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack ip floating create ext-net</div></pre></td></tr></table></figure>
</li>
<li><p>将创建的floating ip关联到实例上</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># openstack ip floating add 192.168.1.xxx demo-ins</div></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/02/17/test/" rel="next" title="test">
                <i class="fa fa-chevron-left"></i> test
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/mee.jpg"
               alt="Joe" />
          <p class="site-author-name" itemprop="name">Joe</p>
           
              <p class="site-description motion-element" itemprop="description">歪，妖妖灵吗</p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、硬件服务器"><span class="nav-number">1.</span> <span class="nav-text">一、硬件服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、OpenStack部署规划"><span class="nav-number">2.</span> <span class="nav-text">二、OpenStack部署规划</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#硬件需求"><span class="nav-number">2.1.</span> <span class="nav-text">硬件需求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#网络模型"><span class="nav-number">2.2.</span> <span class="nav-text">网络模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#网络布局"><span class="nav-number">2.3.</span> <span class="nav-text">网络布局</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ML2网桥选择"><span class="nav-number">2.4.</span> <span class="nav-text">ML2网桥选择</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#网络配置"><span class="nav-number">2.5.</span> <span class="nav-text">网络配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#各项服务密码设置"><span class="nav-number">2.6.</span> <span class="nav-text">各项服务密码设置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、物理主机基本配置"><span class="nav-number">3.</span> <span class="nav-text">三、物理主机基本配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、OpenStack基本配置"><span class="nav-number">4.</span> <span class="nav-text">四、OpenStack基本配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#网络环境准备"><span class="nav-number">4.1.</span> <span class="nav-text">网络环境准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置网卡"><span class="nav-number">4.2.</span> <span class="nav-text">配置网卡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改hostname及hosts"><span class="nav-number">4.3.</span> <span class="nav-text">修改hostname及hosts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置NTP"><span class="nav-number">4.4.</span> <span class="nav-text">配置NTP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置OpenStack版本"><span class="nav-number">4.5.</span> <span class="nav-text">配置OpenStack版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL数据库"><span class="nav-number">4.6.</span> <span class="nav-text">SQL数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#消息队列"><span class="nav-number">4.7.</span> <span class="nav-text">消息队列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Memcached"><span class="nav-number">4.8.</span> <span class="nav-text">Memcached</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五、身份认证服务-Identity-Service-–-Keystone"><span class="nav-number">5.</span> <span class="nav-text">五、身份认证服务 Identity Service – Keystone</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#为Keystone创建数据库"><span class="nav-number">5.1.</span> <span class="nav-text">为Keystone创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装并配置组件"><span class="nav-number">5.2.</span> <span class="nav-text">安装并配置组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置Apache-HTTP-server"><span class="nav-number">5.3.</span> <span class="nav-text">配置Apache HTTP server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建-domain，project，user，role"><span class="nav-number">5.4.</span> <span class="nav-text">创建 domain，project，user，role</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#验证操作"><span class="nav-number">5.5.</span> <span class="nav-text">验证操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#环境变量脚本"><span class="nav-number">5.6.</span> <span class="nav-text">环境变量脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#六、镜像管理服务-Image-Service-–-Glance"><span class="nav-number">6.</span> <span class="nav-text">六、镜像管理服务 Image Service – Glance</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#为Glance创建数据库"><span class="nav-number">6.1.</span> <span class="nav-text">为Glance创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为glance服务创建用户，服务实体，访问点"><span class="nav-number">6.2.</span> <span class="nav-text">为glance服务创建用户，服务实体，访问点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装和配置镜像服务"><span class="nav-number">6.3.</span> <span class="nav-text">安装和配置镜像服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重启服务，完成安装"><span class="nav-number">6.4.</span> <span class="nav-text">重启服务，完成安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#七、计算服务-Compute-Service-–-Nova"><span class="nav-number">7.</span> <span class="nav-text">七、计算服务 Compute Service – Nova</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#为Nova创建数据库"><span class="nav-number">7.1.</span> <span class="nav-text">为Nova创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为nova服务创建用户，服务实体，访问点"><span class="nav-number">7.2.</span> <span class="nav-text">为nova服务创建用户，服务实体，访问点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装和配置计算服务"><span class="nav-number">7.3.</span> <span class="nav-text">安装和配置计算服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重启服务，完成安装-1"><span class="nav-number">7.4.</span> <span class="nav-text">重启服务，完成安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装和配置计算服务-1"><span class="nav-number">7.5.</span> <span class="nav-text">安装和配置计算服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#完成安装"><span class="nav-number">7.6.</span> <span class="nav-text">完成安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#验证操作-1"><span class="nav-number">7.7.</span> <span class="nav-text">验证操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#八、网络服务-Networking-Service-–-Neutron"><span class="nav-number">8.</span> <span class="nav-text">八、网络服务 Networking Service – Neutron</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#为Neutron创建数据库"><span class="nav-number">8.1.</span> <span class="nav-text">为Neutron创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为neutron服务创建用户，服务实体，访问点"><span class="nav-number">8.2.</span> <span class="nav-text">为neutron服务创建用户，服务实体，访问点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#网络架构部署"><span class="nav-number">8.3.</span> <span class="nav-text">网络架构部署</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置插件及代理"><span class="nav-number">8.4.</span> <span class="nav-text">配置插件及代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#完成安装-1"><span class="nav-number">8.5.</span> <span class="nav-text">完成安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装网neutron相关组件"><span class="nav-number">8.6.</span> <span class="nav-text">安装网neutron相关组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#完成安装-2"><span class="nav-number">8.7.</span> <span class="nav-text">完成安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#九、前端仪表盘-Dashboard-–-Horizon"><span class="nav-number">9.</span> <span class="nav-text">九、前端仪表盘 Dashboard – Horizon</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装和配置仪表盘"><span class="nav-number">9.1.</span> <span class="nav-text">安装和配置仪表盘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#验证操作-2"><span class="nav-number">9.2.</span> <span class="nav-text">验证操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十、创建虚拟机实例"><span class="nav-number">10.</span> <span class="nav-text">十、创建虚拟机实例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建provider虚拟网络"><span class="nav-number">10.1.</span> <span class="nav-text">创建provider虚拟网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建self-service虚拟网络及路由器"><span class="nav-number">10.2.</span> <span class="nav-text">创建self-service虚拟网络及路由器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#验证虚拟网络"><span class="nav-number">10.3.</span> <span class="nav-text">验证虚拟网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#准备创建实例的参数"><span class="nav-number">10.4.</span> <span class="nav-text">准备创建实例的参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#增加安全组规则"><span class="nav-number">10.5.</span> <span class="nav-text">增加安全组规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在self-service网络上创建虚拟机实例"><span class="nav-number">10.6.</span> <span class="nav-text">在self-service网络上创建虚拟机实例</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Joe</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


</body>
</html>
